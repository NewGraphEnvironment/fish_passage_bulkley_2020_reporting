# Results

Field assessments were conducted between `r format(min(pscis$date), format="%B %d %Y")` and `r format(max(pscis$date), format="%B %d %Y")` by Allan Irvine, R.P.Bio, Kyle Prince, P,Biol and Mark Fjeld, BiT.  

## Phase 1

A total of `r n_distinct(pscis$my_crossing_reference)` phase 1 assessments were conducted between with site details and photos presented in [Appendix - Phase 1 Fish Passage Assessment Data and Photos].  A cost benefit analysis for phase 1 sites is summarized in Table \@ref(tab:cost-est-phase-1).

<br>

```{r cost-est-phase-1}
tab_cost_est_phase1 %>% 
  my_kable_scroll(caption_text = 'Modelled upstream habitat estimate and cost benefit for Phase 1 assessments.')
  # kable(caption = 'Modelled upstream habitat estimate and cost benefit.',
  #       escape = T) %>% 
  # kableExtra::kable_styling(c("condensed"), full_width = T, font_size = 11) %>% 
  # kableExtra::scroll_box(width = "100%", height = "500px")

```


## Phase 2

 
Habitat confirmation assessments were conducted at `r hab_site_priorities %>% nrow()` with a total of approximately 15 km of stream assessed. `r hab_site_priorities %>% filter(priority %ilike% 'high') %>% nrow() %>% english::as.english() %>% str_to_title()` crossings were rated as high priorities for remediation design, `r hab_site_priorities %>% filter(priority %ilike% 'Moderate') %>% nrow() %>% english::as.english() %>% str_to_title()` crossings rated as moderate priorities, `r hab_site_priorities %>% filter(priority %ilike% 'Low') %>% nrow() %>% english::as.english()` crossing was rated as a low priority and `r hab_site_priorities %>% filter(priority %ilike% 'no fix') %>% nrow() %>% english::as.english()` rated as "no fix". 

<br>


Raw results are included in digital format as [Attachment 2](https://github.com/NewGraphEnvironment/fish_passage_elk_2020_reporting/raw/master/data/habitat_confirmations.xls) and summarized in Tables \@ref(tab:tab-overview) - \@ref(tab:tab-habitat-summary)


<br>

```{r map-interactive, eval= html_on, fig.cap='Map of habitat confirmation sites.'}
##make colors for the priorities
pal <- 
   colorFactor(palette = c("red", "yellow", "grey", "black"), 
               levels = c("high", "moderate", "low", "no fix"))

#https://stackoverflow.com/questions/61026700/bring-a-group-of-markers-to-front-in-leaflet
# marker_options <- markerOptions(  
#   zIndexOffset = 1000)
tracks <- sf::read_sf("./data/habitat_confirmation_tracks.gpx", layer = "tracks") 
  
map <- leaflet(height=500, width=780) %>%
  # leaflet() %>% 
  addTiles() %>%
  leafem::addMouseCoordinates(proj4 = 26911) %>% ##can't seem to get it to render utms yet
  addProviderTiles(providers$"Esri.DeLorme") %>% 
  # addProviderTiles("Esri.WorldTopoMap", group = "Topo") %>%
  addProviderTiles("Esri.WorldImagery", group = "ESRI Aerial") %>% 
  
  # addMeasure() %>% 
  # setView(lng = -105.644, lat = 51.618, zoom = 3)
  
  # addPolylines(data=drake::readd(fish_habitat_model_lines),  opacity=1, color = '#6498d2',
  #              fillOpacity = 0.75, weight=2) %>% 
  # addPolylines(data=forest_tenure_road_lines,  opacity=1, color = '#ff7f00',
  #              fillOpacity = 0.75, weight=2) %>%
  addPolylines(data=tracks,  opacity=0.75, color = '#e216c4',
               fillOpacity = 0.75, weight=5) %>%
  addLegend(
    position = "topright",
    colors = c("red", "yellow", "grey", "black"),
    labels = c("High", "Moderate", "Low", 'No fix'), opacity = 1,
    title = "Fish Passage Priorities",
  ) %>% 
  # addAwesomeMarkers(lng = photo_metadata$lon_map,lat = photo_metadata$lat_map,
  #                   popup = leafpop::popupImage(photo_metadata$url, src = "remote"),
  #                   clusterOptions = markerClusterOptions(),
  #                   labelOptions = offset(c(0,0)),
  #                   label = paste0(photo_metadata$crossing_id, '_', photo_metadata$filename)) %>%
    addCircleMarkers(
    data=tab_hab_map,
    label = tab_hab_map$pscis_crossing_id,
    popup = leafpop::popupTable(x = select((tab_hab_map %>% st_set_geometry(NULL)), 
                                           Site = pscis_crossing_id, Priority = priority, Stream = stream_name, Road = road_name, `Habitat (m)`= upstream_habitat_length_m, Comments = comments),
                                feature.id = F,
                                row.numbers = F), 
    radius = 9,
    fillColor = ~pal(priority),
    color= "#ffffff",
    stroke = TRUE, 
    fillOpacity = 1.0,
    weight = 2,
    opacity = 1.0 
    ) %>% 
      addScaleBar(position = 'bottomleft', options = scaleBarOptions(imperial = FALSE)) %>% 
  addLayersControl(
    baseGroups = c(
      "Esri.DeLorme",
      "ESRI Aerial"),
    # overlayGroups = c(my_tracks$`125000_ds_track`),
    options = layersControlOptions(collapsed = F)) %>% 
  leaflet.extras::addFullscreenControl() %>% 
  addMiniMap(tiles = providers$"Esri.NatGeoWorldMap",
             zoomLevelOffset = -6)

map


```


<br

```{r tab-overview}
# tab_overview %>% 
#   kable(caption = 'Overview of habitat confirmation sites.') %>% 
#   kableExtra::kable_styling(c("condensed"), full_width = T, font_size = 11) %>% 
#   kableExtra::scroll_box(width = "100%", height = "500px")

tab_overview %>% 
  my_kable_scroll(caption_text = 'Overview of habitat confirmation sites.')
```

<br>

```{r}
make_tab_cv(dat = pscis2) %>% 
  my_kable(caption_text = 'Summary of Phase 2 fish passage reassessments.')
```

<br>

```{r cost-est-phase-2}
tab_cost_est_phase2_report %>% 
  my_kable_scroll(caption_text = 'Cost benefit analysis for Phase 2 assessments.')
  # kable(caption = 'Modelled upstream habitat estimate and cost benefit.',
  #       escape = T) %>% 
  # kableExtra::kable_styling(c("condensed"), full_width = T, font_size = 11) %>% 
  # kableExtra::scroll_box(width = "100%", height = "500px")

```

<br>

```{r tab-habitat-summary}
tab_hab_summary %>% 
  filter(Location %ilike% 'upstream') %>% 
  select(-Location) %>% 
  my_kable(caption_text = 'Summary of Phase 2 habitat confirmation details.')

```

